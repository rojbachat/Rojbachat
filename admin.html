<!DOCTYPE html>
<html>
<head>
<title>Admin Panel - Roj Bachat</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body { font-family: Arial; padding:20px; background:#f5f5f5; }
h2 { text-align:center; }
button { padding:8px 12px; margin:5px; border:none; border-radius:5px; cursor:pointer; }
.logout-btn { background:red; color:white; float:right; }
table { width:100%; border-collapse: collapse; margin-top:20px; }
th, td { border:1px solid #333; padding:8px; text-align:center; }
input { padding:8px; margin-top:10px; width:50%; }
</style>

</head>
<body>

<h2>Admin Panel - Roj Bachat</h2>
<button class="logout-btn" onclick="logout()">Logout</button>

<input type="text" id="searchInput" placeholder="Search user by name or email" onkeyup="searchUser()">

<table>
<thead>
<tr>
<th>Name</th>
<th>Email</th>
<th>Mobile</th>
<th>Action</th>
</tr>
</thead>
<tbody id="userTable"></tbody>
</table>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyC98Lxjn6jn-V9NqjcOGluL04EAX4kzpmY",
    authDomain: "rojbachat-7e5a8.firebaseapp.com",
    projectId: "rojbachat-7e5a8",
    storageBucket: "rojbachat-7e5a8.firebasestorage.app",
    messagingSenderId: "790739371754",
    appId: "1:790739371754:web:9b0bd71f2579d664747993"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

// ------------------- ADMIN AUTH CHECK -------------------
auth.onAuthStateChanged((user)=>{
    if(!user) {
        window.location.href = "login.html";
        return;
    }
    if(user.email !== "rojbachat.admin@gmail.com"){
        alert("You are not Admin!");
        window.location.href = "index.html";
    }
});

// ------------------- LOGOUT -------------------
function logout(){
    auth.signOut().then(()=>window.location.href="login.html");
}

// ------------------- LOAD USERS -------------------
let allUsers = [];
db.collection("users").onSnapshot(snapshot=>{
    allUsers = [];
    let html = "";
    snapshot.forEach(doc=>{
        let data = doc.data();
        data.id = doc.id;
        allUsers.push(data);
        html += `<tr>
            <td>${data.name || "-"}</td>
            <td>${data.email}</td>
            <td>${data.mobile || "-"}</td>
            <td>
                <button onclick="viewUser('${doc.id}')">View</button>
                <button onclick="deleteUser('${doc.id}')">Delete</button>
            </td>
        </tr>`;
    });
    document.getElementById("userTable").innerHTML = html;
});

// ------------------- VIEW USER DETAILS -------------------
function viewUser(id){
    let user = allUsers.find(u=>u.id === id);
    if(user){
        alert(
            `Name: ${user.name || "-"}\nEmail: ${user.email}\nMobile: ${user.mobile || "-"}\nBank: ${user.bank || "-"}\nPAN: ${user.pan || "-"}\nAadhaar: ${user.aadhaar || "-"}\nUPI: ${user.upi || "-"}`
        );
    }
}

// ------------------- DELETE USER -------------------
function deleteUser(id){
    if(confirm("Are you sure to delete this user?")){
        db.collection("users").doc(id).delete()
        .then(()=>alert("User deleted successfully"))
        .catch(err=>alert(err.message));
    }
}

// ------------------- SEARCH USER -------------------
function searchUser(){
    let input = document.getElementById("searchInput").value.toLowerCase();
    let html = "";
    allUsers.forEach(u=>{
        if((u.name && u.name.toLowerCase().includes(input)) || 
           (u.email && u.email.toLowerCase().includes(input))){
            html += `<tr>
                <td>${u.name || "-"}</td>
                <td>${u.email}</td>
                <td>${u.mobile || "-"}</td>
                <td>
                    <button onclick="viewUser('${u.id}')">View</button>
                    <button onclick="deleteUser('${u.id}')">Delete</button>
                </td>
            </tr>`;
        }
    });
    document.getElementById("userTable").innerHTML = html;
}
</script>

</body>
</html>
