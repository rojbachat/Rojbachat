<script>
const firebaseConfig = {
  apiKey: "AIzaSyC98Lxjn6jn-V9NqjcOGluL04EAX4kzpmY",
  authDomain: "rojbachat-7e5a8.firebaseapp.com",
  projectId: "rojbachat-7e5a8",
  storageBucket: "rojbachat-7e5a8.firebasestorage.app",
  messagingSenderId: "790739371754",
  appId: "1:790739371754:web:9b0bd71f2579d664747993"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// ---------------- Wallet Balance -----------------
auth.onAuthStateChanged((user)=>{
    if(!user) window.location.href="login.html";
    else loadBalance();
});

function loadBalance(){
    db.collection("users").doc(auth.currentUser.uid)
    .onSnapshot(doc => {
        document.getElementById("walletBalance").innerText = doc.data().wallet || 0;
    });
}

// ---------------- Withdraw System -----------------
async function withdraw(){
    let amount = Number(amountInput.value);
    let upi = upiInput.value.trim();

    if(amount < 100){
        alert("Minimum withdrawal is ₹100");
        return;
    }
    if(upi.length < 5){
        alert("Enter valid UPI ID");
        return;
    }

    const userRef = db.collection("users").doc(auth.currentUser.uid);
    const userDoc = await userRef.get();
    let currentBalance = userDoc.data().wallet || 0;

    if(amount > currentBalance){
        alert("Insufficient Wallet Balance");
        return;
    }

    // 1️⃣ Wallet Deduct
    await userRef.update({
        wallet: currentBalance - amount
    });

    // 2️⃣ Wallet History Entry
    await db.collection("users")
    .doc(auth.currentUser.uid)
    .collection("history")
    .add({
        type: "withdraw",
        amount: amount,
        method: upi,
        timestamp: Date.now()
    });

    // 3️⃣ Withdraw Request Admin Panel
    await db.collection("withdraw_requests").add({
        uid: auth.currentUser.uid,
        amount: amount,
        upi: upi,
        status: "pending",
        timestamp: Date.now()
    });

    alert("Withdraw request submitted!");
    amountInput.value = "";
    upiInput.value = "";
}
                               </script>
