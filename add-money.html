<!DOCTYPE html>
<html>
<head>
<title>Daily Saving - Add Money</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<!-- Razorpay -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

</head>
<body>

<h2>Your Wallet: <span id="walletBalance">â‚¹0</span></h2>

<input type="number" id="amount" placeholder="Enter Amount" />
<button onclick="startPayment()">Add Money</button>

<script>
// ---------------- FIREBASE CONFIG ----------------
const firebaseConfig = {
  apiKey: "AIzaSyC98Lxjn6jn-V9NqjcOGluL04EAX4kzpmY",
  authDomain: "rojbachat-7e5a8.firebaseapp.com",
  projectId: "rojbachat-7e5a8",
  storageBucket: "rojbachat-7e5a8.firebasestorage.app",
  messagingSenderId: "790739371754",
  appId: "1:790739371754:web:9b0bd71f2579d664747993"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ðŸ‘‰ Example User ID (same use karo)
const USER_ID = "user001";


// ------------ FETCH CURRENT WALLET BALANCE --------------
function loadWallet() {
  db.collection("wallets").doc(USER_ID).get().then(doc => {
    if (doc.exists) {
      document.getElementById("walletBalance").innerText = "â‚¹" + doc.data().balance;
    } else {
      document.getElementById("walletBalance").innerText = "â‚¹0";
    }
  });
}
loadWallet();


// -------------------- PAYMENT ---------------------------
function startPayment() {
  let amount = document.getElementById("amount").value;

  if (!amount || amount <= 0) {
    alert("Enter valid amount");
    return;
  }

  amount = parseInt(amount);

  var options = {
    "key": "rzp_test_RxG5pumybpuVqy",  // <-- yaha apna Razorpay Key ID daalna
    "amount": amount * 100,
    "currency": "INR",
    "name": "Daily Saving",
    "description": "Add Money",
    
    "handler": function (response) {
        // Payment success â†’ Save in Firebase
        updateWallet(amount);
    }
  };

  var rzp1 = new Razorpay(options);
  rzp1.open();
}


// ------------------ UPDATE WALLET -----------------------
function updateWallet(amountAdd) {

  const walletRef = db.collection("wallets").doc(USER_ID);

  walletRef.get().then(doc => {
    let newBalance = amountAdd;

    if (doc.exists) {
      newBalance = doc.data().balance + amountAdd;
    }

    walletRef.set({
      balance: newBalance,
      lastAdded: amountAdd,
      updatedAt: new Date()
    })
    .then(() => {
      alert("Money Added Successfully!");
      loadWallet();   // Refresh Wallet
    });
  });

}
</script>

</body>
</html>
