<!DOCTYPE html>
<html>
<head>
    <title>Add Money - Roj Bachat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
        body {
            margin: 0;
            font-family: Arial;
            padding: 20px;
            background: #f5f5f5;
        }
        .box {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 5px #ccc;
        }
        input, button {
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            border-radius: 8px;
            border: 1px solid #aaa;
        }
        button {
            background: #007bff;
            color: #fff;
            border: none;
            font-size: 17px;
        }
        .wallet {
            background: #007bff;
            color: #fff;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            font-size: 20px;
        }
        a {
            color: #007bff;
        }
    </style>
</head>
<body>

<h2>Add Money</h2>

<div class="wallet">
    Wallet Balance: ₹<span id="walletBalance">0</span>
</div>

<div class="box">
    <label>Enter Amount</label>
    <input type="number" id="amountInput" placeholder="Enter Amount (₹)" />

    <button onclick="addMoney()">Add Money</button>

    <p style="margin-top:15px;">Payment Link:</p>
    <a id="paymentLink" href="#" target="_blank">Open Razorpay Link</a>
</div>


<script>
    // Your Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyC98Lxjn6jn-V9NqjcOGluL04EAX4kzpmY",
      authDomain: "rojbachat-7e5a8.firebaseapp.com",
      projectId: "rojbachat-7e5a8",
      storageBucket: "rojbachat-7e5a8.firebasestorage.app",
      messagingSenderId: "790739371754",
      appId: "1:790739371754:web:9b0bd71f2579d664747993"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // -------- CHECK LOGIN ----------
    auth.onAuthStateChanged((user) => {
        if (!user) {
            window.location.href = "login.html";
        } else {
            loadBalance();
            loadPaymentLink();
        }
    });

    // -------- LOAD WALLET BALANCE ----------
    function loadBalance() {
        db.collection("users").doc(auth.currentUser.uid)
        .onSnapshot(doc => {
            if (doc.exists) {
                document.getElementById("walletBalance").innerText = doc.data().wallet || 0;
            }
        });
    }

    // -------- LOAD ADMIN PAYMENT LINK ----------
    function loadPaymentLink() {
        db.collection("admin").doc("settings").get().then(doc => {
            if (doc.exists) {
                document.getElementById("paymentLink").href = doc.data().razorpay_link;
            } else {
                document.getElementById("paymentLink").innerText = "Admin has not set payment link yet";
            }
        });
    }

    // -------- ADD MONEY BUTTON ----------
    function addMoney() {
        let amount = Number(document.getElementById("amountInput").value);

        if (amount < 10) {
            alert("Minimum ₹10 required");
            return;
        }

        let uid = auth.currentUser.uid;

        // Add pending transaction
        db.collection("transactions").add({
            uid: uid,
            amount: amount,
            type: "add_money",
            status: "pending",
            timestamp: Date.now()
        });

        alert("Request saved! Please complete payment using the link.");
    }
</script>

</body>
</html>
